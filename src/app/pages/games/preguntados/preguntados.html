<section class="wrap">
  <a routerLink="/games" class="back">â† Volver</a>

  <article class="card">
    <h2 class="title">Preguntados</h2>

    <!-- HUD -->
    <div class="hud">
      <div class="hud-box">
        <div class="hud-label">Intentos</div>
        <div class="hud-value">{{ intentos() }} / {{ INTENTOS_MAX }}</div>
        <div class="hud-bar">
          <div
            class="hud-bar-fill"
            [style.width.%]="(intentos() / INTENTOS_MAX) * 100">
          </div>
        </div>
      </div>

      <div class="hud-box">
        <div class="hud-label">Aciertos</div>
        <div class="hud-value">{{ aciertos() }}</div>
      </div>

      <div class="hud-box">
        <div class="hud-label">Puntos</div>
        <div class="hud-value">{{ puntos() }}</div>
      </div>

      <div class="hud-box">
        <div class="hud-label">Tiempo</div>
        <div class="hud-value">{{ elapsed() }} s</div>
      </div>
    </div>

    <div *ngIf="error()" class="error">{{ error() }}</div>

    <!-- Ruleta -->
    <div class="wheel-wrap" *ngIf="!questions().length && !loading()">
      <h3 class="subtitle">ElegÃ­ categorÃ­a al azar</h3>

      <div class="wheel" [class.spin]="spinning()">
        <div class="slice s0"><span>ğŸ¬</span></div>
        <div class="slice s1"><span>ğŸ§ª</span></div>
        <div class="slice s2"><span>ğŸ—ºï¸</span></div>
        <div class="slice s3"><span>ğŸ›ï¸</span></div>
        <div class="slice s4"><span>ğŸ¨</span></div>
        <div class="slice s5"><span>ğŸ…</span></div>
      </div>
      <div class="needle">â–²</div>

      <button class="btn primary" (click)="spinWheel()" [disabled]="spinning()">
        Girar
      </button>

      <!-- ejemplo seguro -->
    <p *ngIf="selectedCat() as cat" class="picked">
      CategorÃ­a: <b>{{ cat.emoji }} {{ cat.name }}</b>
    </p>

    <!-- y cuando muestres preguntas: -->
    <ng-container *ngIf="questions().length; else espera">
      <!-- usar current() con confianza -->
    </ng-container>
    <ng-template #espera></ng-template>


      <!-- Si querÃ©s usar imÃ¡genes en lugar de emoji:
           ReemplazÃ¡ cada <span> por <img src="/assets/ruleta/arte.png">
           y ajustÃ¡ el CSS .slice span -> .slice img { width:48px; height:48px; } -->
    </div>

    <!-- Preguntas -->
    <ng-container *ngIf="questions().length">
      <p class="meta">
        Pregunta {{ idx() + 1 }} / {{ questions().length }}
      </p>

      <h3 class="question">{{ current().q }}</h3>

      <div class="answers">
        <button
          *ngFor="let opt of current().options; let i = index"
          class="answer"
          [class.correct]="answered() !== null && i === current().correctIndex"
          [class.wrong]="answered() !== null && i === answered() && i !== current().correctIndex"
          [disabled]="answered() !== null"
          (click)="choose(i)">
          {{ opt }}
        </button>
      </div>

      <div class="actions">
        <button class="btn" (click)="retry()">Reiniciar</button>
        <button class="btn primary" (click)="next()" [disabled]="answered() === null">
          {{ idx() === questions().length - 1 ? 'Finalizar' : 'Siguiente' }}
        </button>
      </div>
    </ng-container>

    <!-- Fin -->
    <div class="finish" *ngIf="finished()">
      <h3>Â¡Fin del juego!</h3>
      <p>
        Puntos: <b>{{ puntos() }}</b> â€” Aciertos: <b>{{ aciertos() }}</b> â€” Tiempo:
        <b>{{ elapsed() }}s</b>
      </p>
      <div class="actions">
        <button class="btn" (click)="retry()">Jugar de nuevo</button>
        <a routerLink="/results" class="btn ghost">Ver resultados</a>
      </div>
    </div>
  </article>
</section>
